src.dackar.knowledge_graph.KGconstruction
=========================================

.. py:module:: src.dackar.knowledge_graph.KGconstruction

.. autoapi-nested-parse::

   Created on September, 2025

   @author: mandd, wangc



Attributes
----------

.. autoapisummary::

   src.dackar.knowledge_graph.KGconstruction.currentDir


Classes
-------

.. autoapisummary::

   src.dackar.knowledge_graph.KGconstruction.KG


Functions
---------

.. autoapisummary::

   src.dackar.knowledge_graph.KGconstruction.stringToDatetimeConverterFlexible


Module Contents
---------------

.. py:data:: currentDir

.. py:class:: KG(configFilePath, importFolderPath, uri, pwd, user)

   Class designed to automate and check knowledge graph construction


   .. py:attribute:: datatypes
      :value: ['string', 'integer', 'floating', 'boolean', 'datetime']



   .. py:attribute:: py2neo


   .. py:attribute:: graphSchemas


   .. py:attribute:: graphMetadata


   .. py:attribute:: entityLibrary


   .. py:attribute:: predefinedGraphSchemas


   .. py:method:: resetGraph()

      Method designed to reset knowledge graph
      @ In, None
      @ Out, None



   .. py:method:: _crossSchemasCheck()

      Method designed to perform a series of checks across the defined schemas
      @ In, None
      @ Out, None



   .. py:method:: _checkSchemaStructure(importedSchema)

      Method designed to check importedSchema against self.baseSchema
      @ In, importedSchema, dict, schema parsed by tomllib from .toml file
      @ Out, None



   .. py:method:: importGraphSchema(graphSchemaName, tomlFilename)

      Method that imports new schema contained in a .toml file
      @ In, graphSchemaName, string, name of the schema to be imported
      @ In, tomlFilename, string, .toml file contained the new schema
      @ Out, None



   .. py:method:: _checkSchemaDataTypes(schema)

      Method that checks that the datatypes defined in the new schema are part of the allowed data
      types contained in self.datatypes
      @ In, schema, dict, schema parsed by tomllib from .toml file
      @ Out, None



   .. py:method:: _schemaReturnNodeProperties(nodeLabel)

      Method that returns the properties of the node nodeLabel
      @ In, nodeLabel, string, ID of the node label
      @ Out, propdf, dataframe, dataframe containing nodeLabel properties



   .. py:method:: _schemaReturnRelationProperties(relation)

      Method that returns the properties of the selected relation
      @ In, relation, string, ID of the node label
      @ Out, propdf, dataframe, dataframe containing relation properties



   .. py:method:: _constructionSchemaStructureValidation(constructionSchema)

      Method that validates the structure of constructionSchema
      @ In, constructionSchema, dict, construction schema
      @ Out, None



   .. py:method:: _constructionSchemaValidation(constructionSchema)

      Method that validates the constructionSchema against defined schemas
      @ In, constructionSchema, dict, construction schema
      @ Out, None



   .. py:method:: genericWorkflow(data, constructionSchema)

      Method designed to importa data into knowledge graph according to constructionSchema
      @ In, data, pd.dataframe, pandas dataframe containing data to be imported in the knowledge graph
      @ Out, constructionSchema, dict, dataframe containing relation properties. A construction schema is defined as follows:

          constructionSchema = {'nodes'    : nodeConstructionSchema,
                                'relations': edgeConstructionSchema}

          nodeConstructionSchema = {'nodeLabel1': {'property1': 'dataframe.colA', 'property2': 'dataframe.colB'},
                                    'nodeLabel2': {'property1': 'dataframe.colC'}}

          edgeConstructionSchema = [{'source': {'nodeLabel1.property1':'dataframe.col1'},
                                     'target': {'nodeLabel2.property1':'dataframe.col2'},
                                     'type'  : 'edgeType',
                                     'properties': {'property1': 'dataframe.colAlpha', 'property2': 'dataframe.colBeta'}}]



   .. py:method:: _checkDataframeDatatypes(data, constructionSchema)

      Method that checks that data elements in data match format specified in the graph schemas
      @ In, data, pd.dataframe, pandas dataframe containing data to be imported in the knowledge graph
      @ In, constructionSchema, dict, dataframe containing relation properties
      @ Out, None



   .. py:method:: _returnNodePropertyDatatype(nodeID, propID)

      Method that returns the allowed type of a specified node property
      @ In, nodeID, string, specific node label
      @ In, propID, string, specific node property
      @ Out, allowedType, string, allowed type of the specified node property



   .. py:method:: _returnRelationPropertyDatatype(relID, propID)

      Method that returns the allowed type of a specified relation property.
      @ In, relID, string, specific relation
      @ In, propID, string, specific node property
      @ Out, allowedType, string, allowed type of the specified relation property



.. py:function:: stringToDatetimeConverterFlexible(dateString, formatCode=None)

   Method that convert a string into datetime according to specific format
   @ In, dateString, string, string containing date
   @ In, formatCode, string, datetime specific format
   @ Out, datetimeObject, datetime, datetime object


